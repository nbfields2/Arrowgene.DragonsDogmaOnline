using Arrowgene.Ddon.GameServer.Characters;
using Arrowgene.Ddon.Server;
using Arrowgene.Ddon.Shared.Entity.PacketStructure;
using Arrowgene.Ddon.Shared.Model.Quest;
using Arrowgene.Ddon.Shared.Network;
using Arrowgene.Logging;
using System.Linq;

namespace Arrowgene.Ddon.GameServer.Handler
{
    public class QuestGetSetQuestInfoListHandler : GameRequestPacketHandler<C2SQuestGetSetQuestInfoListReq, S2CQuestGetSetQuestInfoListRes>
    {
        private static readonly ServerLogger Logger = LogProvider.Logger<ServerLogger>(typeof(QuestGetSetQuestInfoListHandler));

        private static readonly byte[] PcapData = new byte[] { 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x0F,0x00,0x05,0xF7,0x8A,0x01,0x31,0x40,0x88,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x1E,0x82,0x00,0x00,0x22,0xF4,0x00,0x00,0x24,0xBF,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x59,0x00,0x00,0x00,0x00,0x00,0x0E,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x08,0xC1,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x64,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xF7,0x88,0x01,0x31,0x2D,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x00,0x94,0x00,0x00,0x00,0x2A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x23,0xEC,0x00,0x00,0x1D,0x81,0x00,0x00,0x24,0xCD,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x4C,0x00,0x00,0x00,0x00,0x00,0x28,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0x42,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x64,0x00,0x00,0x01,0x22,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x06,0x00,0x05,0xF7,0x8C,0x01,0x31,0x40,0x8C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x02,0x21,0x00,0x00,0x00,0x19,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x02,0x26,0x00,0x00,0x02,0xF9,0x00,0x00,0x1E,0x59,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x65,0x00,0x00,0x00,0x00,0x00,0x19,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0x64,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0xF7,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xF7,0x8D,0x01,0x31,0x40,0x93,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x02,0x5D,0x00,0x00,0x03,0x32,0x00,0x00,0x24,0xD5,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x62,0x00,0x00,0x00,0x00,0x00,0x1E,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x04,0x48,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x64,0x00,0x00,0x00,0x0B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xF7,0xFF,0x01,0x31,0x40,0x92,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x03,0x86,0x00,0x00,0x00,0x14,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x23,0x00,0x00,0x24,0xBF,0x00,0x00,0x24,0xC1,0x01,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x46,0x00,0x00,0x00,0x00,0x00,0x14,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x08,0xC2,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x64,0x00,0x00,0x00,0x1A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xF6,0xFE,0x01,0x31,0x40,0x89,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x1F,0xE3,0x00,0x00,0x24,0x96,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x84,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x85,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x01,0x5A,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x64,0x00,0x00,0x00,0x08,0x00,0x00,0x08,0xA5,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x64,0x00,0x00,0x00,0x1C,0x00,0x00,0x03,0x76,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x64,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xF7,0x85,0x01,0x31,0x2D,0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x02,0x27,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x1E,0x33,0x00,0x00,0x1E,0x99,0x00,0x00,0x1E,0xB7,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x21,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x5A,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x09,0xB3,0x00,0x00,0x00,0x01,0x00,0x00,0x02,0x3D,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x00,0x00,0x05,0xF7,0x89,0x01,0x31,0x2D,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x00,0x2A,0x00,0x00,0x00,0x37,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x24,0xE3,0x00,0x00,0x1E,0xE6,0x00,0x00,0x1F,0x54,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x0D,0x00,0x00,0x00,0x00,0x00,0x37,0x00,0x00,0x00,0x00,0x0E,0x00,0x00,0x00,0x00,0x00,0x37,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0x50,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x64,0x00,0x00,0x01,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x08,0x00,0x05,0xF6,0xFD,0x01,0x31,0x2D,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x02,0x22,0x00,0x00,0x00,0x3A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x1E,0xE5,0x00,0x00,0x1F,0x55,0x00,0x00,0x1F,0x0B,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x23,0x00,0x00,0x00,0x00,0x00,0x3A,0x00,0x00,0x00,0x00,0x9A,0x00,0x00,0x00,0x00,0x00,0x39,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0x32,0x00,0x00,0x00,0x01,0x00,0x00,0x02,0xDB,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x09,0x00,0x05,0xF7,0x86,0x01,0x31,0x2D,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x20,0x7E,0x00,0x00,0x20,0x97,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xF7,0x87,0x01,0x31,0x2D,0x0A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x5F,0x00,0x00,0x27,0x3F,0x00,0x00,0x24,0xB1,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x43,0x00,0x00,0x00,0x00,0x00,0x0B,0x00,0x00,0x00,0x00,0x88,0x00,0x00,0x00,0x00,0x00,0x0B,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0x3C,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x64,0x00,0x00,0x00,0x26,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xF7,0x8B,0x01,0x31,0x40,0x8A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x01,0xF9,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x1E,0xAD,0x00,0x00,0x00,0x37,0x01,0x02,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x9B,0x00,0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x9C,0x00,0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0x5E,0x00,0x00,0x00,0x01,0x00,0x00,0x02,0x25,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xF8,0x21,0x01,0x40,0x6F,0x41,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x02,0x27,0x00,0x00,0x00,0x39,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x2D,0xEF,0x00,0x00,0x1E,0xAD,0x00,0x00,0x24,0x94,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xAE,0x00,0x00,0x00,0x00,0x00,0x39,0x00,0x00,0x00,0x00,0x65,0x00,0x00,0x00,0x00,0x00,0x37,0x00,0x00,0x00,0x00,0x5A,0x00,0x00,0x00,0x00,0x00,0x39,0x00,0x00,0x00,0x00,0xC4,0x00,0x00,0x00,0x00,0x00,0x37,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x0B,0xAB,0x00,0x00,0x00,0x01,0x00,0x00,0x02,0x41,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x1F,0x16,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x0D,0x00,0x05,0xF7,0x8E,0x01,0x40,0x6F,0x4C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x39,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x1F,0x17,0x00,0x00,0x1E,0xDD,0x00,0x00,0x00,0x29,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x4D,0x00,0x00,0x00,0x00,0x00,0x39,0x01,0x00,0x00,0x00,0x37,0x00,0x00,0x00,0x00,0x00,0x39,0x00,0x00,0x00,0x00,0xA0,0x00,0x00,0x00,0x00,0x00,0x39,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x0B,0xAF,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0xF6,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x0B,0x00,0x05,0xF6,0xFF,0x01,0x40,0x6F,0x5A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5D,0xC3,0x6C,0x90,0x00,0x00,0x02,0x29,0x00,0x00,0x00,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x2A,0xF7,0x00,0x00,0x1F,0x61,0x00,0x00,0x24,0x94,0x02,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x52,0x00,0x00,0x00,0x00,0x00,0x3C,0x01,0x00,0x00,0x00,0x52,0x00,0x00,0x00,0x00,0x00,0x39,0x01,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x3C,0x00,0x00,0x00,0x00,0x5A,0x00,0x00,0x00,0x00,0x00,0x3C,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x0B,0xB7,0x00,0x00,0x00,0x01,0x00,0x00,0x02,0x41,0x00,0x00,0x00,0x0B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x0D,0x00,0x01,0x00,0x12,0x00,0x00,0x00,0x00 };

        public QuestGetSetQuestInfoListHandler(DdonGameServer server) : base(server)
        {
        }

        public override S2CQuestGetSetQuestInfoListRes Handle(GameClient client, C2SQuestGetSetQuestInfoListReq request)
        {
            var res = new S2CQuestGetSetQuestInfoListRes()
            {
                DistributeId = request.DistributeId
            };

            res.SetQuestList = QuestManager.GetQuestsByType(QuestType.World)
                .Where(x => QuestManager.IsWorldQuest(x.Key)
                    && x.Value.QuestAreaId == request.DistributeId
                    && client.Party.QuestState.HasActiveQuest(x.Key))
                .Select(x => x.Value.ToCDataSetQuestInfoList())
                .ToList();

            return res;
        }
    }
}
